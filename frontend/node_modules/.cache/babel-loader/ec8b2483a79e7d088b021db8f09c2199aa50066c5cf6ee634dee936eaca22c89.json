{"ast":null,"code":"import _objectSpread from\"C:/Users/Neerush Buchi/Desktop/Neerush Folder/HMS/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useAuth}from'../context/AuthContext';import{useNavigate}from'react-router-dom';import api from'../services/api';import PaymentForm from'./components/PaymentForm';import Invoice from'./components/Invoice';// sensible defaults so the UI works even if the backend endpoint is empty/unavailable\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const DEFAULT_DEPARTMENTS=['General Medicine','Cardiology','Orthopedics','Neurology','Pediatrics','Dermatology','ENT','Gynecology'];const BookAppointment=()=>{var _selectedDoctor$avail,_selectedDoctor$avail2;const{user}=useAuth();const navigate=useNavigate();const[formData,setFormData]=useState({department:'',doctorId:'',date:'',time:'',purpose:'',symptoms:''});const[departments,setDepartments]=useState(DEFAULT_DEPARTMENTS);const[doctors,setDoctors]=useState([]);const[availableSlots,setAvailableSlots]=useState([]);const[loading,setLoading]=useState(false);const[step,setStep]=useState(1);const[selectedDoctor,setSelectedDoctor]=useState(null);const[showPayment,setShowPayment]=useState(false);const[appointmentId,setAppointmentId]=useState(null);const[billId,setBillId]=useState(null);const[showInvoice,setShowInvoice]=useState(false);useEffect(()=>{if(!user){navigate('/login');return;}fetchDepartments();},[user,navigate]);// Listen for global appointmentCancelled events to refresh available slots\nuseEffect(()=>{const handler=e=>{const{doctorId,date}=e.detail||{};if(doctorId&&date&&doctorId===formData.doctorId&&date===formData.date){// If the cancelled appointment is for the currently selected doctor/date, refresh slots\nfetchAvailableSlots(doctorId,date);}};window.addEventListener('appointmentCancelled',handler);return()=>window.removeEventListener('appointmentCancelled',handler);},[formData.doctorId,formData.date]);const fetchDepartments=async()=>{try{var _response$data,_response$data$data;// Fetch from the departments collection endpoint\nconst response=await api.get('/departments');const returned=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:(_response$data$data=_response$data.data)===null||_response$data$data===void 0?void 0:_response$data$data.departments;setDepartments(Array.isArray(returned)&&returned.length>0?returned.map(d=>d.name):DEFAULT_DEPARTMENTS);}catch(error){console.error('Error fetching departments:',error);// keep fallback so UI still works\nsetDepartments(DEFAULT_DEPARTMENTS);}};const fetchDoctors=async department=>{try{const response=await api.get(\"/appointments/doctors/\".concat(department));setDoctors(response.data.data.doctors);}catch(error){console.error('Error fetching doctors:',error);alert('Error loading doctors');}};const fetchAvailableSlots=async(doctorId,date)=>{try{const response=await api.get(\"/appointments/available-slots/\".concat(doctorId,\"?date=\").concat(date));setAvailableSlots(response.data.data.availableSlots);}catch(error){console.error('Error fetching available slots:',error);alert('Error loading available time slots');}};const handleDepartmentChange=e=>{const department=e.target.value;setFormData(_objectSpread(_objectSpread({},formData),{},{department,doctorId:'',date:'',time:''}));setDoctors([]);setAvailableSlots([]);setSelectedDoctor(null);if(department){fetchDoctors(department);setStep(2);}else{setStep(1);}};const handleDoctorChange=e=>{const doctorId=e.target.value;const doctor=doctors.find(doc=>doc._id===doctorId);setFormData(_objectSpread(_objectSpread({},formData),{},{doctorId,date:'',time:''}));setAvailableSlots([]);setSelectedDoctor(doctor);if(doctorId){setStep(3);}else{setStep(2);}};const handleDateChange=e=>{const date=e.target.value;setFormData(_objectSpread(_objectSpread({},formData),{},{date,time:''}));setAvailableSlots([]);if(date&&formData.doctorId){fetchAvailableSlots(formData.doctorId,date);setStep(4);}};const handleTimeSelect=time=>{setFormData(_objectSpread(_objectSpread({},formData),{},{time}));setStep(5);};const handleInputChange=e=>{setFormData(_objectSpread(_objectSpread({},formData),{},{[e.target.name]:e.target.value}));};const handleSubmit=async e=>{e.preventDefault();if(!formData.doctorId||!formData.date||!formData.time||!formData.purpose){alert('Please fill in all required fields');return;}setLoading(true);try{const response=await api.post('/appointments',formData);if(response.data.status==='success'){setAppointmentId(response.data.data.appointment._id);setShowPayment(true);}}catch(error){var _error$response,_error$response$data;console.error('Error booking appointment:',error);alert(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Error booking appointment');}finally{setLoading(false);}};const handlePaymentComplete=async paymentDetails=>{try{// Get the patient ID first\nconst patientResponse=await api.get('/patients/me');if(!patientResponse.data.data.patient){throw new Error('Patient profile not found');}const patientId=patientResponse.data.data.patient._id;// First create the bill\nconst billingResponse=await api.post('/billing',{appointmentId,patient:patientId,doctorId:formData.doctorId,amount:selectedDoctor.consultationFee,paymentMode:paymentDetails.method.toUpperCase(),paymentStatus:'Paid',paymentDetails:paymentDetails.details});if(billingResponse.data.status==='success'){// Keep appointment status as 'Pending' — doctor will confirm the appointment later.\n// We still save the bill and show the invoice to the patient.\nsetBillId(billingResponse.data.data.bill._id);setShowPayment(false);setShowInvoice(true);}}catch(error){var _error$response2,_error$response3;console.error('Error processing payment:',error);let errorMessage='Error processing payment. Please try again.';if(error.message==='Patient profile not found'){errorMessage='Your patient profile was not found. Please contact support.';}else if(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===404){errorMessage='Could not find the appointment. Please try booking again.';}else if(((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===403){errorMessage='You are not authorized to update this appointment.';}alert(errorMessage);setShowPayment(false);// Close payment form on error\n}};const handleViewInvoice=()=>{setShowInvoice(true);};const handleDownloadInvoice=async()=>{try{const response=await api.get(\"/billing/\".concat(billId));const bill=response.data.data.bill;// Generate PDF invoice using the bill data\n// You can implement the PDF generation logic here\n}catch(error){console.error('Error downloading invoice:',error);alert('Error downloading invoice. Please try again.');}};const handlePaymentSuccess=()=>{alert('Payment successful! You can view or download your invoice.');navigate('/patient-dashboard');};const getMinDate=()=>{const today=new Date();return today.toISOString().split('T')[0];};const getMaxDate=()=>{const maxDate=new Date();maxDate.setMonth(maxDate.getMonth()+2);// 2 months in advance\nreturn maxDate.toISOString().split('T')[0];};if(!user){return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-required\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Authentication Required\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please log in to book an appointment.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>navigate('/login'),children:\"Go to Login\"})]})});}const styles={overlay:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.7)',display:'flex',justifyContent:'center',alignItems:'center',zIndex:1000},modal:{backgroundColor:'#fff',padding:'2rem',borderRadius:'8px',maxWidth:'600px',width:'90%',maxHeight:'90vh',overflowY:'auto'},invoiceActions:{display:'flex',gap:'1rem',marginBottom:'1rem',justifyContent:'flex-end'}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"booking-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"booking-header\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-calendar-plus\"}),\" Book Appointment\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"progress-steps\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"step \".concat(step>=1?'active':''),children:[/*#__PURE__*/_jsx(\"span\",{children:\"1\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Department\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"step \".concat(step>=2?'active':''),children:[/*#__PURE__*/_jsx(\"span\",{children:\"2\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Doctor\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"step \".concat(step>=3?'active':''),children:[/*#__PURE__*/_jsx(\"span\",{children:\"3\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Date\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"step \".concat(step>=4?'active':''),children:[/*#__PURE__*/_jsx(\"span\",{children:\"4\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Time\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"step \".concat(step>=5?'active':''),children:[/*#__PURE__*/_jsx(\"span\",{children:\"5\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Details\"})]})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"appointment-form\",children:[step>=1&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Select Department\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"department\",children:\"Medical Department *\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"department\",name:\"department\",value:formData.department,onChange:handleDepartmentChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Choose a department\"}),departments.map(dept=>/*#__PURE__*/_jsx(\"option\",{value:dept,children:dept},dept))]})]})]}),step>=2&&doctors.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Select Doctor\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"doctor\",children:\"Available Doctors *\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"doctor\",name:\"doctorId\",value:formData.doctorId,onChange:handleDoctorChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Choose a doctor\"}),doctors.map(doctor=>/*#__PURE__*/_jsxs(\"option\",{value:doctor._id,children:[doctor.name,\" - \",doctor.specialization,\" (\\u20B9\",doctor.consultationFee,\")\"]},doctor._id))]})]}),selectedDoctor&&/*#__PURE__*/_jsxs(\"div\",{className:\"doctor-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Doctor Information\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",selectedDoctor.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Specialization:\"}),\" \",selectedDoctor.specialization]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Department:\"}),\" \",selectedDoctor.department]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Consultation Fee:\"}),\" \\u20B9\",selectedDoctor.consultationFee]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Availability:\"}),\" \",(_selectedDoctor$avail=selectedDoctor.availability)===null||_selectedDoctor$avail===void 0?void 0:(_selectedDoctor$avail2=_selectedDoctor$avail.days)===null||_selectedDoctor$avail2===void 0?void 0:_selectedDoctor$avail2.join(', ')]})]})]}),step>=3&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Select Date\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"date\",children:\"Appointment Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"date\",name:\"date\",value:formData.date,onChange:handleDateChange,min:getMinDate(),max:getMaxDate(),required:true})]})]}),step>=4&&availableSlots.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Select Time Slot\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Available Time Slots *\"}),/*#__PURE__*/_jsx(\"div\",{className:\"time-slots\",children:availableSlots.map((slot,index)=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"time-slot \".concat(formData.time===slot.time?'selected':'',\" \").concat(!slot.available?'disabled':''),onClick:()=>slot.available&&handleTimeSelect(slot.time),disabled:!slot.available,children:[slot.time,!slot.available&&/*#__PURE__*/_jsx(\"span\",{className:\"slot-status\",children:\"Booked\"})]},index))}),formData.time&&/*#__PURE__*/_jsxs(\"p\",{className:\"selected-time\",children:[\"Selected time: \",/*#__PURE__*/_jsx(\"strong\",{children:formData.time})]})]})]}),step>=5&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Appointment Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"purpose\",children:\"Purpose of Visit *\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"purpose\",name:\"purpose\",value:formData.purpose,onChange:handleInputChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select purpose\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Consultation\",children:\"General Consultation\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Follow-up\",children:\"Follow-up Visit\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Checkup\",children:\"Routine Checkup\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Emergency\",children:\"Emergency\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Test Results\",children:\"Test Results Discussion\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Other\",children:\"Other\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"symptoms\",children:\"Symptoms or Additional Information\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"symptoms\",name:\"symptoms\",value:formData.symptoms,onChange:handleInputChange,rows:\"4\",placeholder:\"Describe your symptoms or any additional information...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"appointment-summary\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Appointment Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-details\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Department:\"}),\" \",formData.department]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Doctor:\"}),\" \",selectedDoctor===null||selectedDoctor===void 0?void 0:selectedDoctor.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Date:\"}),\" \",new Date(formData.date).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Time:\"}),\" \",formData.time]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Purpose:\"}),\" \",formData.purpose]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Consultation Fee:\"}),\" \\u20B9\",selectedDoctor===null||selectedDoctor===void 0?void 0:selectedDoctor.consultationFee]})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary submit-btn\",disabled:loading,children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-spinner fa-spin\"}),\" Booking Appointment...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-right\"}),\" Proceed to Payment\"]})})]}),step<5&&/*#__PURE__*/_jsx(\"div\",{className:\"form-navigation\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"step-guide\",children:[step===1&&'Select a medical department to continue',step===2&&'Choose a doctor from the available specialists',step===3&&'Select your preferred appointment date',step===4&&'Pick an available time slot']})})]})]}),showPayment&&/*#__PURE__*/_jsx(\"div\",{style:styles.overlay,children:/*#__PURE__*/_jsx(\"div\",{style:styles.modal,children:/*#__PURE__*/_jsx(PaymentForm,{amount:selectedDoctor===null||selectedDoctor===void 0?void 0:selectedDoctor.consultationFee,onPaymentComplete:handlePaymentComplete,onCancel:()=>setShowPayment(false)})})}),showInvoice&&/*#__PURE__*/_jsx(\"div\",{style:styles.overlay,children:/*#__PURE__*/_jsxs(\"div\",{style:styles.modal,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12},children:[/*#__PURE__*/_jsxs(\"div\",{style:{color:'#856404',backgroundColor:'#fff3cd',padding:'10px 12px',borderRadius:6,border:'1px solid #ffeeba',maxWidth:'75%'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Pending confirmation:\"}),\" Your appointment is currently \",/*#__PURE__*/_jsx(\"em\",{children:\"Pending\"}),\". The doctor will confirm the appointment after reviewing the request. You can view or download the invoice below.\"]}),/*#__PURE__*/_jsxs(\"div\",{style:styles.invoiceActions,children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleViewInvoice,className:\"btn btn-primary\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-eye\"}),\" View Invoice\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleDownloadInvoice,className:\"btn btn-secondary\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-download\"}),\" Download Invoice\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handlePaymentSuccess,className:\"btn btn-success\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check\"}),\" Done\"]})]})]}),/*#__PURE__*/_jsx(Invoice,{billId:billId,appointment:{doctor:selectedDoctor,date:formData.date,time:formData.time,department:formData.department,purpose:formData.purpose},patient:user,amount:selectedDoctor===null||selectedDoctor===void 0?void 0:selectedDoctor.consultationFee})]})})]});};export default BookAppointment;","map":{"version":3,"names":["React","useState","useEffect","useAuth","useNavigate","api","PaymentForm","Invoice","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DEFAULT_DEPARTMENTS","BookAppointment","_selectedDoctor$avail","_selectedDoctor$avail2","user","navigate","formData","setFormData","department","doctorId","date","time","purpose","symptoms","departments","setDepartments","doctors","setDoctors","availableSlots","setAvailableSlots","loading","setLoading","step","setStep","selectedDoctor","setSelectedDoctor","showPayment","setShowPayment","appointmentId","setAppointmentId","billId","setBillId","showInvoice","setShowInvoice","fetchDepartments","handler","e","detail","fetchAvailableSlots","window","addEventListener","removeEventListener","_response$data","_response$data$data","response","get","returned","data","Array","isArray","length","map","d","name","error","console","fetchDoctors","concat","alert","handleDepartmentChange","target","value","_objectSpread","handleDoctorChange","doctor","find","doc","_id","handleDateChange","handleTimeSelect","handleInputChange","handleSubmit","preventDefault","post","status","appointment","_error$response","_error$response$data","message","handlePaymentComplete","paymentDetails","patientResponse","patient","Error","patientId","billingResponse","amount","consultationFee","paymentMode","method","toUpperCase","paymentStatus","details","bill","_error$response2","_error$response3","errorMessage","handleViewInvoice","handleDownloadInvoice","handlePaymentSuccess","getMinDate","today","Date","toISOString","split","getMaxDate","maxDate","setMonth","getMonth","className","children","onClick","styles","overlay","position","top","left","right","bottom","backgroundColor","display","justifyContent","alignItems","zIndex","modal","padding","borderRadius","maxWidth","width","maxHeight","overflowY","invoiceActions","gap","marginBottom","onSubmit","htmlFor","id","onChange","required","dept","specialization","availability","days","join","type","min","max","slot","index","available","disabled","rows","placeholder","toLocaleDateString","style","onPaymentComplete","onCancel","color","border"],"sources":["C:/Users/Neerush Buchi/Desktop/Neerush Folder/HMS/frontend/src/pages/BookAppointment.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../services/api';\r\nimport PaymentForm from './components/PaymentForm';\r\nimport Invoice from './components/Invoice';\r\n\r\n// sensible defaults so the UI works even if the backend endpoint is empty/unavailable\r\nconst DEFAULT_DEPARTMENTS = [\r\n  'General Medicine',\r\n  'Cardiology',\r\n  'Orthopedics',\r\n  'Neurology',\r\n  'Pediatrics',\r\n  'Dermatology',\r\n  'ENT',\r\n  'Gynecology'\r\n];\r\n\r\nconst BookAppointment = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  \r\n  const [formData, setFormData] = useState({\r\n    department: '',\r\n    doctorId: '',\r\n    date: '',\r\n    time: '',\r\n    purpose: '',\r\n    symptoms: ''\r\n  });\r\n  \r\n  const [departments, setDepartments] = useState(DEFAULT_DEPARTMENTS);\r\n  const [doctors, setDoctors] = useState([]);\r\n  const [availableSlots, setAvailableSlots] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [step, setStep] = useState(1);\r\n  const [selectedDoctor, setSelectedDoctor] = useState(null);\r\n  const [showPayment, setShowPayment] = useState(false);\r\n  const [appointmentId, setAppointmentId] = useState(null);\r\n  const [billId, setBillId] = useState(null);\r\n  const [showInvoice, setShowInvoice] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!user) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n    fetchDepartments();\r\n  }, [user, navigate]);\r\n\r\n  // Listen for global appointmentCancelled events to refresh available slots\r\n  useEffect(() => {\r\n    const handler = (e) => {\r\n      const { doctorId, date } = e.detail || {};\r\n      if (doctorId && date && doctorId === formData.doctorId && date === formData.date) {\r\n        // If the cancelled appointment is for the currently selected doctor/date, refresh slots\r\n        fetchAvailableSlots(doctorId, date);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('appointmentCancelled', handler);\r\n    return () => window.removeEventListener('appointmentCancelled', handler);\r\n  }, [formData.doctorId, formData.date]);\r\n\r\n  const fetchDepartments = async () => {\r\n    try {\r\n      // Fetch from the departments collection endpoint\r\n      const response = await api.get('/departments');\r\n      const returned = response?.data?.data?.departments;\r\n      setDepartments(Array.isArray(returned) && returned.length > 0 ? returned.map(d => d.name) : DEFAULT_DEPARTMENTS);\r\n    } catch (error) {\r\n      console.error('Error fetching departments:', error);\r\n      // keep fallback so UI still works\r\n      setDepartments(DEFAULT_DEPARTMENTS);\r\n    }\r\n  };\r\n\r\n  const fetchDoctors = async (department) => {\r\n    try {\r\n      const response = await api.get(`/appointments/doctors/${department}`);\r\n      setDoctors(response.data.data.doctors);\r\n    } catch (error) {\r\n      console.error('Error fetching doctors:', error);\r\n      alert('Error loading doctors');\r\n    }\r\n  };\r\n\r\n  const fetchAvailableSlots = async (doctorId, date) => {\r\n    try {\r\n      const response = await api.get(`/appointments/available-slots/${doctorId}?date=${date}`);\r\n      setAvailableSlots(response.data.data.availableSlots);\r\n    } catch (error) {\r\n      console.error('Error fetching available slots:', error);\r\n      alert('Error loading available time slots');\r\n    }\r\n  };\r\n\r\n  const handleDepartmentChange = (e) => {\r\n    const department = e.target.value;\r\n    setFormData({\r\n      ...formData,\r\n      department,\r\n      doctorId: '',\r\n      date: '',\r\n      time: ''\r\n    });\r\n    setDoctors([]);\r\n    setAvailableSlots([]);\r\n    setSelectedDoctor(null);\r\n    \r\n    if (department) {\r\n      fetchDoctors(department);\r\n      setStep(2);\r\n    } else {\r\n      setStep(1);\r\n    }\r\n  };\r\n\r\n  const handleDoctorChange = (e) => {\r\n    const doctorId = e.target.value;\r\n    const doctor = doctors.find(doc => doc._id === doctorId);\r\n    \r\n    setFormData({\r\n      ...formData,\r\n      doctorId,\r\n      date: '',\r\n      time: ''\r\n    });\r\n    setAvailableSlots([]);\r\n    setSelectedDoctor(doctor);\r\n    \r\n    if (doctorId) {\r\n      setStep(3);\r\n    } else {\r\n      setStep(2);\r\n    }\r\n  };\r\n\r\n  const handleDateChange = (e) => {\r\n    const date = e.target.value;\r\n    setFormData({\r\n      ...formData,\r\n      date,\r\n      time: ''\r\n    });\r\n    setAvailableSlots([]);\r\n    \r\n    if (date && formData.doctorId) {\r\n      fetchAvailableSlots(formData.doctorId, date);\r\n      setStep(4);\r\n    }\r\n  };\r\n\r\n  const handleTimeSelect = (time) => {\r\n    setFormData({\r\n      ...formData,\r\n      time\r\n    });\r\n    setStep(5);\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!formData.doctorId || !formData.date || !formData.time || !formData.purpose) {\r\n      alert('Please fill in all required fields');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    \r\n    try {\r\n      const response = await api.post('/appointments', formData);\r\n      \r\n      if (response.data.status === 'success') {\r\n        setAppointmentId(response.data.data.appointment._id);\r\n        setShowPayment(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error booking appointment:', error);\r\n      alert(error.response?.data?.message || 'Error booking appointment');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePaymentComplete = async (paymentDetails) => {\r\n    try {\r\n      // Get the patient ID first\r\n      const patientResponse = await api.get('/patients/me');\r\n      if (!patientResponse.data.data.patient) {\r\n        throw new Error('Patient profile not found');\r\n      }\r\n      const patientId = patientResponse.data.data.patient._id;\r\n\r\n      // First create the bill\r\n      const billingResponse = await api.post('/billing', {\r\n        appointmentId,\r\n        patient: patientId,\r\n        doctorId: formData.doctorId,\r\n        amount: selectedDoctor.consultationFee,\r\n        paymentMode: paymentDetails.method.toUpperCase(),\r\n        paymentStatus: 'Paid',\r\n        paymentDetails: paymentDetails.details\r\n      });\r\n\r\n      if (billingResponse.data.status === 'success') {\r\n        // Keep appointment status as 'Pending' — doctor will confirm the appointment later.\r\n        // We still save the bill and show the invoice to the patient.\r\n        setBillId(billingResponse.data.data.bill._id);\r\n        setShowPayment(false);\r\n        setShowInvoice(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error processing payment:', error);\r\n      let errorMessage = 'Error processing payment. Please try again.';\r\n      \r\n      if (error.message === 'Patient profile not found') {\r\n        errorMessage = 'Your patient profile was not found. Please contact support.';\r\n      } else if (error.response?.status === 404) {\r\n        errorMessage = 'Could not find the appointment. Please try booking again.';\r\n      } else if (error.response?.status === 403) {\r\n        errorMessage = 'You are not authorized to update this appointment.';\r\n      }\r\n      \r\n      alert(errorMessage);\r\n      setShowPayment(false);  // Close payment form on error\r\n    }\r\n  };\r\n\r\n  const handleViewInvoice = () => {\r\n    setShowInvoice(true);\r\n  };\r\n\r\n  const handleDownloadInvoice = async () => {\r\n    try {\r\n      const response = await api.get(`/billing/${billId}`);\r\n      const bill = response.data.data.bill;\r\n      // Generate PDF invoice using the bill data\r\n      // You can implement the PDF generation logic here\r\n    } catch (error) {\r\n      console.error('Error downloading invoice:', error);\r\n      alert('Error downloading invoice. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handlePaymentSuccess = () => {\r\n    alert('Payment successful! You can view or download your invoice.');\r\n    navigate('/patient-dashboard');\r\n  };\r\n\r\n  const getMinDate = () => {\r\n    const today = new Date();\r\n    return today.toISOString().split('T')[0];\r\n  };\r\n\r\n  const getMaxDate = () => {\r\n    const maxDate = new Date();\r\n    maxDate.setMonth(maxDate.getMonth() + 2); // 2 months in advance\r\n    return maxDate.toISOString().split('T')[0];\r\n  };\r\n\r\n  if (!user) {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"auth-required\">\r\n          <h2>Authentication Required</h2>\r\n          <p>Please log in to book an appointment.</p>\r\n          <button \r\n            className=\"btn\" \r\n            onClick={() => navigate('/login')}\r\n          >\r\n            Go to Login\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const styles = {\r\n    overlay: {\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      right: 0,\r\n      bottom: 0,\r\n      backgroundColor: 'rgba(0, 0, 0, 0.7)',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n      zIndex: 1000\r\n    },\r\n    modal: {\r\n      backgroundColor: '#fff',\r\n      padding: '2rem',\r\n      borderRadius: '8px',\r\n      maxWidth: '600px',\r\n      width: '90%',\r\n      maxHeight: '90vh',\r\n      overflowY: 'auto'\r\n    },\r\n    invoiceActions: {\r\n      display: 'flex',\r\n      gap: '1rem',\r\n      marginBottom: '1rem',\r\n      justifyContent: 'flex-end'\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"booking-card\">\r\n        <div className=\"booking-header\">\r\n          <h1><i className=\"fas fa-calendar-plus\"></i> Book Appointment</h1>\r\n          <div className=\"progress-steps\">\r\n            <div className={`step ${step >= 1 ? 'active' : ''}`}>\r\n              <span>1</span>\r\n              <p>Department</p>\r\n            </div>\r\n            <div className={`step ${step >= 2 ? 'active' : ''}`}>\r\n              <span>2</span>\r\n              <p>Doctor</p>\r\n            </div>\r\n            <div className={`step ${step >= 3 ? 'active' : ''}`}>\r\n              <span>3</span>\r\n              <p>Date</p>\r\n            </div>\r\n            <div className={`step ${step >= 4 ? 'active' : ''}`}>\r\n              <span>4</span>\r\n              <p>Time</p>\r\n            </div>\r\n            <div className={`step ${step >= 5 ? 'active' : ''}`}>\r\n              <span>5</span>\r\n              <p>Details</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <form onSubmit={handleSubmit} className=\"appointment-form\">\r\n          {/* Step 1: Department Selection */}\r\n          {step >= 1 && (\r\n            <div className=\"form-section\">\r\n              <h3>Select Department</h3>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"department\">Medical Department *</label>\r\n                <select\r\n                  id=\"department\"\r\n                  name=\"department\"\r\n                  value={formData.department}\r\n                  onChange={handleDepartmentChange}\r\n                  required\r\n                >\r\n                  <option value=\"\">Choose a department</option>\r\n                  {departments.map(dept => (\r\n                    <option key={dept} value={dept}>\r\n                      {dept}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Step 2: Doctor Selection */}\r\n          {step >= 2 && doctors.length > 0 && (\r\n            <div className=\"form-section\">\r\n              <h3>Select Doctor</h3>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"doctor\">Available Doctors *</label>\r\n                <select\r\n                  id=\"doctor\"\r\n                  name=\"doctorId\"\r\n                  value={formData.doctorId}\r\n                  onChange={handleDoctorChange}\r\n                  required\r\n                >\r\n                  <option value=\"\">Choose a doctor</option>\r\n                  {doctors.map(doctor => (\r\n                    <option key={doctor._id} value={doctor._id}>\r\n                      {doctor.name} - {doctor.specialization} (₹{doctor.consultationFee})\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {selectedDoctor && (\r\n                <div className=\"doctor-info\">\r\n                  <h4>Doctor Information</h4>\r\n                  <p><strong>Name:</strong> {selectedDoctor.name}</p>\r\n                  <p><strong>Specialization:</strong> {selectedDoctor.specialization}</p>\r\n                  <p><strong>Department:</strong> {selectedDoctor.department}</p>\r\n                  <p><strong>Consultation Fee:</strong> ₹{selectedDoctor.consultationFee}</p>\r\n                  <p><strong>Availability:</strong> {selectedDoctor.availability?.days?.join(', ')}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Step 3: Date Selection */}\r\n          {step >= 3 && (\r\n            <div className=\"form-section\">\r\n              <h3>Select Date</h3>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"date\">Appointment Date *</label>\r\n                <input\r\n                  type=\"date\"\r\n                  id=\"date\"\r\n                  name=\"date\"\r\n                  value={formData.date}\r\n                  onChange={handleDateChange}\r\n                  min={getMinDate()}\r\n                  max={getMaxDate()}\r\n                  required\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Step 4: Time Selection */}\r\n          {step >= 4 && availableSlots.length > 0 && (\r\n            <div className=\"form-section\">\r\n              <h3>Select Time Slot</h3>\r\n              <div className=\"form-group\">\r\n                <label>Available Time Slots *</label>\r\n                <div className=\"time-slots\">\r\n                  {availableSlots.map((slot, index) => (\r\n                    <button\r\n                      key={index}\r\n                      type=\"button\"\r\n                      className={`time-slot ${formData.time === slot.time ? 'selected' : ''} ${\r\n                        !slot.available ? 'disabled' : ''\r\n                      }`}\r\n                      onClick={() => slot.available && handleTimeSelect(slot.time)}\r\n                      disabled={!slot.available}\r\n                    >\r\n                      {slot.time}\r\n                      {!slot.available && <span className=\"slot-status\">Booked</span>}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n                {formData.time && (\r\n                  <p className=\"selected-time\">\r\n                    Selected time: <strong>{formData.time}</strong>\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Step 5: Appointment Details */}\r\n          {step >= 5 && (\r\n            <div className=\"form-section\">\r\n              <h3>Appointment Details</h3>\r\n              \r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"purpose\">Purpose of Visit *</label>\r\n                <select\r\n                  id=\"purpose\"\r\n                  name=\"purpose\"\r\n                  value={formData.purpose}\r\n                  onChange={handleInputChange}\r\n                  required\r\n                >\r\n                  <option value=\"\">Select purpose</option>\r\n                  <option value=\"Consultation\">General Consultation</option>\r\n                  <option value=\"Follow-up\">Follow-up Visit</option>\r\n                  <option value=\"Checkup\">Routine Checkup</option>\r\n                  <option value=\"Emergency\">Emergency</option>\r\n                  <option value=\"Test Results\">Test Results Discussion</option>\r\n                  <option value=\"Other\">Other</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"symptoms\">Symptoms or Additional Information</label>\r\n                <textarea\r\n                  id=\"symptoms\"\r\n                  name=\"symptoms\"\r\n                  value={formData.symptoms}\r\n                  onChange={handleInputChange}\r\n                  rows=\"4\"\r\n                  placeholder=\"Describe your symptoms or any additional information...\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"appointment-summary\">\r\n                <h4>Appointment Summary</h4>\r\n                <div className=\"summary-details\">\r\n                  <p><strong>Department:</strong> {formData.department}</p>\r\n                  <p><strong>Doctor:</strong> {selectedDoctor?.name}</p>\r\n                  <p><strong>Date:</strong> {new Date(formData.date).toLocaleDateString()}</p>\r\n                  <p><strong>Time:</strong> {formData.time}</p>\r\n                  <p><strong>Purpose:</strong> {formData.purpose}</p>\r\n                  <p><strong>Consultation Fee:</strong> ₹{selectedDoctor?.consultationFee}</p>\r\n                </div>\r\n              </div>\r\n\r\n              <button \r\n                type=\"submit\" \r\n                className=\"btn btn-primary submit-btn\"\r\n                disabled={loading}\r\n              >\r\n                {loading ? (\r\n                  <>\r\n                    <i className=\"fas fa-spinner fa-spin\"></i> Booking Appointment...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <i className=\"fas fa-arrow-right\"></i> Proceed to Payment\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {step < 5 && (\r\n            <div className=\"form-navigation\">\r\n              <p className=\"step-guide\">\r\n                {step === 1 && 'Select a medical department to continue'}\r\n                {step === 2 && 'Choose a doctor from the available specialists'}\r\n                {step === 3 && 'Select your preferred appointment date'}\r\n                {step === 4 && 'Pick an available time slot'}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </form>\r\n      </div>\r\n\r\n      {showPayment && (\r\n        <div style={styles.overlay}>\r\n          <div style={styles.modal}>\r\n            <PaymentForm\r\n              amount={selectedDoctor?.consultationFee}\r\n              onPaymentComplete={handlePaymentComplete}\r\n              onCancel={() => setShowPayment(false)}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showInvoice && (\r\n        <div style={styles.overlay}>\r\n          <div style={styles.modal}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>\r\n              <div style={{ color: '#856404', backgroundColor: '#fff3cd', padding: '10px 12px', borderRadius: 6, border: '1px solid #ffeeba', maxWidth: '75%' }}>\r\n                <strong>Pending confirmation:</strong> Your appointment is currently <em>Pending</em>. The doctor will confirm the appointment after reviewing the request. You can view or download the invoice below.\r\n              </div>\r\n              <div style={styles.invoiceActions}>\r\n                <button onClick={handleViewInvoice} className=\"btn btn-primary\">\r\n                  <i className=\"fas fa-eye\"></i> View Invoice\r\n                </button>\r\n                <button onClick={handleDownloadInvoice} className=\"btn btn-secondary\">\r\n                  <i className=\"fas fa-download\"></i> Download Invoice\r\n                </button>\r\n                <button onClick={handlePaymentSuccess} className=\"btn btn-success\">\r\n                  <i className=\"fas fa-check\"></i> Done\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <Invoice\r\n              billId={billId}\r\n              appointment={{\r\n                doctor: selectedDoctor,\r\n                date: formData.date,\r\n                time: formData.time,\r\n                department: formData.department,\r\n                purpose: formData.purpose\r\n              }}\r\n              patient={user}\r\n              amount={selectedDoctor?.consultationFee}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BookAppointment;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}